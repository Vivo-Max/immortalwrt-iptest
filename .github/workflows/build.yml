name: Build Mediatek Filogic CMCC RAX3000M
on:
  workflow_dispatch: # 支持手动选择平台
  push:
    branches:
      - main
    paths:
      - 'src/**'
      - 'build.sh'
jobs:
  build_mediatek_filogic:
    runs-on: ubuntu-22.04
    steps:
    - name: Checkout Code
      uses: actions/checkout@v4
    - name: Free Disk Space
      uses: jlumbroso/free-disk-space@main
      with:
        tool-cache: true
        android: true
        dotnet: true
        large-packages: true
        swap-storage: true
    - name: Install Dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y build-essential ccache curl file g++ gawk gettext git \
          libncurses-dev libssl-dev ncurses-term openssl \
          python3 python3-setuptools python3-venv python3-pyelftools rsync subversion \
          swig time unzip wget zlib1g-dev
    - name: Run Build Script
      run: |
        chmod +x build.sh
        # 强制指定: 格式 ipk, 平台索引 0 (Mediatek Filogic CMCC RAX3000M)
        ./build.sh ipk 0
    - name: Upload Mediatek Filogic Artifacts
      uses: actions/upload-artifact@v4
      if: success()
      with:
        name: mediatek-filogic-iptest-packages
        path: artifacts/
